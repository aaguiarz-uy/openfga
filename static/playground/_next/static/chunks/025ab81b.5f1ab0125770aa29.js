"use strict";(("undefined"!==typeof self?self:this).webpackChunk_N_E=("undefined"!==typeof self?self:this).webpackChunk_N_E||[]).push([[376],{30479:function(e,t,n){n.d(t,{WE:function(){return ne},qx:function(){return ce},yO:function(){return te}});var i=n(82070),r=n(92728),o=n(96921),a=n(26539),s=n(66137),u=n(83074),l=n(57207),h=n(16290),c=n(85628),d=n(49817),f=n(76008),g=n(90729),v=n(57244),_=n(3994),m=n(33573),p=n(32655),C=n(7831),b=n(20328),k=n(3863),L=n(64773),y=n(2296),D=n(92505),N=n(50320),I=n(26177),T=n(68835),w=n(69413),E=n(39626),S=n(3511),R=n(53684);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function z(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function P(e,t,n){return P="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},P(e,t,n||e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function V(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}function B(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function j(e,t){return!t||"object"!==Q(t)&&"function"!==typeof t?O(e):t}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(u){s=!0,r=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||G(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||G(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Q=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function G(e,t){if(e){if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=F(e);if(t){var r=F(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return j(this,n)}}var J=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},q=function(e,t){return function(n,i){t(n,i,e)}};function Y(e){var t=new _.M;return t.acceptChunk(e),t.finish()}function $(e,t){return("string"===typeof e?Y(e):e).create(t)}var X=0,K=function(){function e(t){M(this,e),this._source=t,this._eos=!1}return z(e,[{key:"read",value:function(){if(this._eos)return null;for(var e=[],t=0,n=0;;){var i=this._source.read();if(null===i)return this._eos=!0,0===t?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=65536)return e.join("")}}}]),e}(),ee=function(){throw new Error("Invalid change accessor")},te=function(e){V(n,e);var t=Z(n);function n(e,i,o){var u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;M(this,n),(u=t.call(this))._undoRedoService=c,u._modeService=d,u._languageConfigurationService=g,u._onWillDispose=u._register(new r.Q5),u.onWillDispose=u._onWillDispose.event,u._onDidChangeDecorations=u._register(new ge((function(e){return u.handleBeforeFireDecorationsChangedEvent(e)}))),u.onDidChangeDecorations=u._onDidChangeDecorations.event,u._onDidChangeLanguage=u._register(new r.Q5),u.onDidChangeLanguage=u._onDidChangeLanguage.event,u._onDidChangeLanguageConfiguration=u._register(new r.Q5),u.onDidChangeLanguageConfiguration=u._onDidChangeLanguageConfiguration.event,u._onDidChangeTokens=u._register(new r.Q5),u.onDidChangeTokens=u._onDidChangeTokens.event,u._onDidChangeOptions=u._register(new r.Q5),u.onDidChangeOptions=u._onDidChangeOptions.event,u._onDidChangeAttached=u._register(new r.Q5),u.onDidChangeAttached=u._onDidChangeAttached.event,u._onDidChangeContentOrInjectedText=u._register(new r.Q5),u.onDidChangeContentOrInjectedText=u._onDidChangeContentOrInjectedText.event,u._eventEmitter=u._register(new ve),u._backgroundTokenizationState=0,u._onBackgroundTokenizationStateChanged=u._register(new r.Q5),u.onBackgroundTokenizationStateChanged=u._onBackgroundTokenizationStateChanged.event,u._register(u._eventEmitter.fastEvent((function(e){u._onDidChangeContentOrInjectedText.fire(e.rawContentChangedEvent)}))),X++,u.id="$model"+X,u.isForSimpleWidget=i.isForSimpleWidget,u._associatedResource="undefined"===typeof l||null===l?s.o.parse("inmemory://model/"+X):l,u._attachedEditorCount=0;var v=$(e,i.defaultEOL),_=v.textBuffer,m=v.disposable;u._buffer=_,u._bufferDisposable=m,u._options=n.resolveOptions(u._buffer,i);var p=u._buffer.getLineCount(),b=u._buffer.getValueLengthInRange(new h.e(1,1,p,u._buffer.getLineLength(p)+1),0);return i.largeFileOptimizations?u._isTooLargeForTokenization=b>n.LARGE_FILE_SIZE_THRESHOLD||p>n.LARGE_FILE_LINE_COUNT_THRESHOLD:u._isTooLargeForTokenization=!1,u._isTooLargeForSyncing=b>n.MODEL_SYNC_LIMIT,u._versionId=1,u._alternativeVersionId=1,u._initialUndoRedoSnapshot=null,u._isDisposed=!1,u._isDisposing=!1,u._languageId=o||L.TG,u._languageRegistryListener=u._languageConfigurationService.onDidChange((function(e){e.affects(u._languageId)&&u._onDidChangeLanguageConfiguration.fire({})})),u._instanceId=a.PJ(X),u._lastDecorationId=0,u._decorations=Object.create(null),u._decorationsTree=new oe,u._commandManager=new f.NL(O(u),u._undoRedoService),u._isUndoing=!1,u._isRedoing=!1,u._trimAutoWhitespaceLines=null,u._tokens=new y.Rl(u._modeService.languageIdCodec),u._tokens2=new y.cx(u._modeService.languageIdCodec),u._tokenization=new C.B(O(u),u._modeService.languageIdCodec),u._bracketPairColorizer=u._register(new w.w(O(u),u._languageConfigurationService)),u._decorationProvider=u._register(new E.z(O(u))),u._register(u._decorationProvider.onDidChange((function(){u._onDidChangeDecorations.beginDeferredEmit(),u._onDidChangeDecorations.fire(),u._onDidChangeDecorations.endDeferredEmit()}))),u}return z(n,[{key:"onDidChangeContentFast",value:function(e){return this._eventEmitter.fastEvent((function(t){return e(t.contentChangedEvent)}))}},{key:"onDidChangeContent",value:function(e){return this._eventEmitter.slowEvent((function(t){return e(t.contentChangedEvent)}))}},{key:"bracketPairs",get:function(){return this._bracketPairColorizer}},{key:"backgroundTokenizationState",get:function(){return this._backgroundTokenizationState}},{key:"handleTokenizationProgress",value:function(e){if(2!==this._backgroundTokenizationState){var t=e?2:1;this._backgroundTokenizationState!==t&&(this._backgroundTokenizationState=t,this._onBackgroundTokenizationStateChanged.fire())}}},{key:"dispose",value:function(){this._isDisposing=!0,this._onWillDispose.fire(),this._languageRegistryListener.dispose(),this._tokenization.dispose(),this._isDisposed=!0,P(F(n.prototype),"dispose",this).call(this),this._bufferDisposable.dispose(),this._isDisposing=!1;var e=new I.A([],"","\n",!1,!1,!0,!0);e.dispose(),this._buffer=e}},{key:"_assertNotDisposed",value:function(){if(this._isDisposed)throw new Error("Model is disposed!")}},{key:"_emitContentChangedEvent",value:function(e,t){this._bracketPairColorizer.handleContentChanged(t),this._isDisposing||this._eventEmitter.fire(new m.fV(e,t))}},{key:"setValue",value:function(e){if(this._assertNotDisposed(),null!==e){var t=$(e,this._options.defaultEOL),n=t.textBuffer,i=t.disposable;this._setValueFromTextBuffer(n,i)}}},{key:"_createContentChanged2",value:function(e,t,n,i,r,o,a){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:r,isRedoing:o,isFlush:a}}},{key:"_setValueFromTextBuffer",value:function(e,t){this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),o=this.getLineMaxColumn(r);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._tokens.flush(),this._tokens2.flush(),this._decorations=Object.create(null),this._decorationsTree=new oe,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new m.dQ([new m.Jx],this._versionId,!1,!1),this._createContentChanged2(new h.e(1,1,r,o),0,i,this.getValue(),!1,!1,!0))}},{key:"setEOL",value:function(e){this._assertNotDisposed();var t=1===e?"\r\n":"\n";if(this._buffer.getEOL()!==t){var n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),o=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new m.dQ([new m.CZ],this._versionId,!1,!1),this._createContentChanged2(new h.e(1,1,r,o),0,i,this.getValue(),!1,!1,!1))}}},{key:"_onBeforeEOLChange",value:function(){this._decorationsTree.ensureAllNodesHaveRanges(this)}},{key:"_onAfterEOLChange",value:function(){for(var e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder(),n=0,i=t.length;n<i;n++){var r=t[n],o=r.range,a=r.cachedAbsoluteStart-r.start,s=this._buffer.getOffsetAt(o.startLineNumber,o.startColumn),u=this._buffer.getOffsetAt(o.endLineNumber,o.endColumn);r.cachedAbsoluteStart=s,r.cachedAbsoluteEnd=u,r.cachedVersionId=e,r.start=s-a,r.end=u-a,(0,v.sR)(r)}}},{key:"onBeforeAttached",value:function(){this._attachedEditorCount++,1===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}},{key:"onBeforeDetached",value:function(){this._attachedEditorCount--,0===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}},{key:"isAttachedToEditor",value:function(){return this._attachedEditorCount>0}},{key:"getAttachedEditorCount",value:function(){return this._attachedEditorCount}},{key:"isTooLargeForSyncing",value:function(){return this._isTooLargeForSyncing}},{key:"isTooLargeForTokenization",value:function(){return this._isTooLargeForTokenization}},{key:"isDisposed",value:function(){return this._isDisposed}},{key:"isDominatedByLongLines",value:function(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;for(var e=0,t=0,n=this._buffer.getLineCount(),i=1;i<=n;i++){var r=this._buffer.getLineLength(i);r>=1e4?t+=r:e+=r}return t>e}},{key:"uri",get:function(){return this._associatedResource}},{key:"getOptions",value:function(){return this._assertNotDisposed(),this._options}},{key:"getFormattingOptions",value:function(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}},{key:"updateOptions",value:function(e){this._assertNotDisposed();var t="undefined"!==typeof e.tabSize?e.tabSize:this._options.tabSize,n="undefined"!==typeof e.indentSize?e.indentSize:this._options.indentSize,i="undefined"!==typeof e.insertSpaces?e.insertSpaces:this._options.insertSpaces,r="undefined"!==typeof e.trimAutoWhitespace?e.trimAutoWhitespace:this._options.trimAutoWhitespace,o="undefined"!==typeof e.bracketColorizationOptions?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,a=new d.dJ({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r,bracketPairColorizationOptions:o});if(!this._options.equals(a)){var s=this._options.createChangeEvent(a);this._options=a,this._onDidChangeOptions.fire(s)}}},{key:"detectIndentation",value:function(e,t){this._assertNotDisposed();var n=(0,g.L)(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}},{key:"normalizeIndentation",value:function(e){return this._assertNotDisposed(),n.normalizeIndentation(e,this._options.indentSize,this._options.insertSpaces)}},{key:"getVersionId",value:function(){return this._assertNotDisposed(),this._versionId}},{key:"mightContainRTL",value:function(){return this._buffer.mightContainRTL()}},{key:"mightContainUnusualLineTerminators",value:function(){return this._buffer.mightContainUnusualLineTerminators()}},{key:"removeUnusualLineTerminators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.findMatches(a.Qe.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map((function(e){return{range:e.range,text:null}})),(function(){return null}))}},{key:"mightContainNonBasicASCII",value:function(){return this._buffer.mightContainNonBasicASCII()}},{key:"getAlternativeVersionId",value:function(){return this._assertNotDisposed(),this._alternativeVersionId}},{key:"getInitialUndoRedoSnapshot",value:function(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}},{key:"getOffsetAt",value:function(e){this._assertNotDisposed();var t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}},{key:"getPositionAt",value:function(e){this._assertNotDisposed();var t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}},{key:"_increaseVersionId",value:function(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}},{key:"_overwriteVersionId",value:function(e){this._versionId=e}},{key:"_overwriteAlternativeVersionId",value:function(e){this._alternativeVersionId=e}},{key:"_overwriteInitialUndoRedoSnapshot",value:function(e){this._initialUndoRedoSnapshot=e}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}},{key:"createSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new K(this._buffer.createSnapshot(e))}},{key:"getValueLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}},{key:"getValueInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}},{key:"getValueLengthInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}},{key:"getCharacterCountInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}},{key:"getLineCount",value:function(){return this._assertNotDisposed(),this._buffer.getLineCount()}},{key:"getLineContent",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineContent(e)}},{key:"getLineLength",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)}},{key:"getLinesContent",value:function(){return this._assertNotDisposed(),this._buffer.getLinesContent()}},{key:"getEOL",value:function(){return this._assertNotDisposed(),this._buffer.getEOL()}},{key:"getEndOfLineSequence",value:function(){return this._assertNotDisposed(),"\n"===this._buffer.getEOL()?0:1}},{key:"getLineMinColumn",value:function(e){return this._assertNotDisposed(),1}},{key:"getLineMaxColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}},{key:"getLineFirstNonWhitespaceColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}},{key:"getLineLastNonWhitespaceColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}},{key:"_validateRangeRelaxedNoAllocations",value:function(e){var t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn,r=Math.floor("number"!==typeof n||isNaN(n)?1:n),o=Math.floor("number"!==typeof i||isNaN(i)?1:i);if(r<1)r=1,o=1;else if(r>t)r=t,o=this.getLineMaxColumn(r);else if(o<=1)o=1;else{var a=this.getLineMaxColumn(r);o>=a&&(o=a)}var s=e.endLineNumber,u=e.endColumn,l=Math.floor("number"!==typeof s||isNaN(s)?1:s),d=Math.floor("number"!==typeof u||isNaN(u)?1:u);if(l<1)l=1,d=1;else if(l>t)l=t,d=this.getLineMaxColumn(l);else if(d<=1)d=1;else{var f=this.getLineMaxColumn(l);d>=f&&(d=f)}return n===r&&i===o&&s===l&&u===d&&B(e,h.e)&&!B(e,c.Y)?e:new h.e(r,o,l,d)}},{key:"_isValidPosition",value:function(e,t,n){if("number"!==typeof e||"number"!==typeof t)return!1;if(isNaN(e)||isNaN(t))return!1;if(e<1||t<1)return!1;if((0|e)!==e||(0|t)!==t)return!1;if(e>this._buffer.getLineCount())return!1;if(1===t)return!0;if(t>this.getLineMaxColumn(e))return!1;if(1===n){var i=this._buffer.getLineCharCode(e,t-2);if(a.ZG(i))return!1}return!0}},{key:"_validatePosition",value:function(e,t,n){var i=Math.floor("number"!==typeof e||isNaN(e)?1:e),r=Math.floor("number"!==typeof t||isNaN(t)?1:t),o=this._buffer.getLineCount();if(i<1)return new l.L(1,1);if(i>o)return new l.L(o,this.getLineMaxColumn(o));if(r<=1)return new l.L(i,1);var s=this.getLineMaxColumn(i);if(r>=s)return new l.L(i,s);if(1===n){var u=this._buffer.getLineCharCode(i,r-2);if(a.ZG(u))return new l.L(i,r-1)}return new l.L(i,r)}},{key:"validatePosition",value:function(e){return this._assertNotDisposed(),B(e,l.L)&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}},{key:"_isValidRange",value:function(e,t){var n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,o=e.endColumn;if(!this._isValidPosition(n,i,0))return!1;if(!this._isValidPosition(r,o,0))return!1;if(1===t){var s=i>1?this._buffer.getLineCharCode(n,i-2):0,u=o>1&&o<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,o-2):0,l=a.ZG(s),h=a.ZG(u);return!l&&!h}return!0}},{key:"validateRange",value:function(e){if(this._assertNotDisposed(),B(e,h.e)&&!B(e,c.Y)&&this._isValidRange(e,1))return e;var t=this._validatePosition(e.startLineNumber,e.startColumn,0),n=this._validatePosition(e.endLineNumber,e.endColumn,0),i=t.lineNumber,r=t.column,o=n.lineNumber,s=n.column,u=r>1?this._buffer.getLineCharCode(i,r-2):0,l=s>1&&s<=this._buffer.getLineLength(o)?this._buffer.getLineCharCode(o,s-2):0,d=a.ZG(u),f=a.ZG(l);return d||f?i===o&&r===s?new h.e(i,r-1,o,s-1):d&&f?new h.e(i,r-1,o,s+1):d?new h.e(i,r-1,o,s):new h.e(i,r,o,s+1):new h.e(i,r,o,s)}},{key:"modifyPosition",value:function(e,t){this._assertNotDisposed();var n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}},{key:"getFullModelRange",value:function(){this._assertNotDisposed();var e=this.getLineCount();return new h.e(1,1,e,this.getLineMaxColumn(e))}},{key:"findMatchesLineByLine",value:function(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}},{key:"findMatches",value:function(e,t,n,i,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:999;this._assertNotDisposed();var s=null;if(null!==t&&(Array.isArray(t)||(t=[t]),t.every((function(e){return h.e.isIRange(e)})))){var u=this;s=t.map((function(e){return u.validateRange(e)}))}null===s&&(s=[this.getFullModelRange()]),s=s.sort((function(e,t){return e.startLineNumber-t.startLineNumber||e.startColumn-t.startColumn}));var l,c=[];if(c.push(s.reduce((function(e,t){return h.e.areIntersecting(e,t)?e.plusRange(t):(c.push(e),t)}))),!n&&e.indexOf("\n")<0){var d=this,f=new p.bc(e,n,i,r),g=f.parseSearchRequest();if(!g)return[];l=function(e){return d.findMatchesLineByLine(e,g,o,a)}}else{var v=this;l=function(t){return p.pM.findMatches(v,new p.bc(e,n,i,r),t,o,a)}}return c.map(l).reduce((function(e,t){return e.concat(t)}),[])}},{key:"findNextMatch",value:function(e,t,n,i,r,o){this._assertNotDisposed();var a=this.validatePosition(t);if(!n&&e.indexOf("\n")<0){var s=new p.bc(e,n,i,r).parseSearchRequest();if(!s)return null;var u=this.getLineCount(),l=new h.e(a.lineNumber,a.column,u,this.getLineMaxColumn(u)),c=this.findMatchesLineByLine(l,s,o,1);return p.pM.findNextMatch(this,new p.bc(e,n,i,r),a,o),c.length>0?c[0]:(l=new h.e(1,1,a.lineNumber,this.getLineMaxColumn(a.lineNumber)),(c=this.findMatchesLineByLine(l,s,o,1)).length>0?c[0]:null)}return p.pM.findNextMatch(this,new p.bc(e,n,i,r),a,o)}},{key:"findPreviousMatch",value:function(e,t,n,i,r,o){this._assertNotDisposed();var a=this.validatePosition(t);return p.pM.findPreviousMatch(this,new p.bc(e,n,i,r),a,o)}},{key:"pushStackElement",value:function(){this._commandManager.pushStackElement()}},{key:"popStackElement",value:function(){this._commandManager.popStackElement()}},{key:"pushEOL",value:function(e){if(("\n"===this.getEOL()?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_validateEditOperation",value:function(e){return B(e,d.Qi)?e:new d.Qi(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}},{key:"_validateEditOperations",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}},{key:"pushEditOperations",value:function(e,t,n){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_pushEditOperations",value:function(e,t,n){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){var i=this,r=t.map((function(e){return{range:i.validateRange(e.range),text:e.text}})),o=!0;if(e)for(var a=0,s=e.length;a<s;a++){for(var u=e[a],l=!1,c=0,f=r.length;c<f;c++){var g=r[c].range,v=g.startLineNumber>u.endLineNumber,_=u.startLineNumber>g.endLineNumber;if(!v&&!_){l=!0;break}}if(!l){o=!1;break}}if(o)for(var m=0,p=this._trimAutoWhitespaceLines.length;m<p;m++){for(var C=this._trimAutoWhitespaceLines[m],b=this.getLineMaxColumn(C),k=!0,L=0,y=r.length;L<y;L++){var D=r[L].range,N=r[L].text;if(!(C<D.startLineNumber||C>D.endLineNumber)&&(!(C===D.startLineNumber&&D.startColumn===b&&D.isEmpty()&&N&&N.length>0&&"\n"===N.charAt(0))&&!(C===D.startLineNumber&&1===D.startColumn&&D.isEmpty()&&N&&N.length>0&&"\n"===N.charAt(N.length-1)))){k=!1;break}}if(k){var I=new h.e(C,1,C,b);t.push(new d.Qi(null,I,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n)}},{key:"_applyUndo",value:function(e,t,n,i){var r=this,o=e.map((function(e){var t=r.getPositionAt(e.newPosition),n=r.getPositionAt(e.newEnd);return{range:new h.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.oldText}}));this._applyUndoRedoEdits(o,t,!0,!1,n,i)}},{key:"_applyRedo",value:function(e,t,n,i){var r=this,o=e.map((function(e){var t=r.getPositionAt(e.oldPosition),n=r.getPositionAt(e.oldEnd);return{range:new h.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.newText}}));this._applyUndoRedoEdits(o,t,!1,!0,n,i)}},{key:"_applyUndoRedoEdits",value:function(e,t,n,i,r,o){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(o),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"applyEdits",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();var n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_doApplyEdits",value:function(e,t){var n=this._buffer.getLineCount(),i=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),r=this._buffer.getLineCount(),o=i.changes;if(this._trimAutoWhitespaceLines=i.trimAutoWhitespaceLineNumbers,0!==o.length){for(var a=this,s=function(e,t){var n=a,i=function(e){var t=h+e,i=C+e;N.takeFromEndWhile((function(e){return e.lineNumber>i}));var r=N.takeFromEndWhile((function(e){return e.lineNumber===i}));_.push(new m.rU(t,n.getLineContent(i),r))},s=o[e],u=U((0,y.QZ)(s.text),1)[0];a._onDidChangeDecorations.fire();for(var h=s.range.startLineNumber,c=s.range.endLineNumber,d=c-h,f=u,g=Math.min(d,f),v=f-d,C=r-p-v+h,b=C,k=C+f,L=a._decorationsTree.getInjectedTextInInterval(a,a.getOffsetAt(new l.L(b,1)),a.getOffsetAt(new l.L(k,a.getLineMaxColumn(k))),0),D=m.gk.fromDecorations(L),N=new T.H9(D),I=g;I>=0;I--)i(I);if(g<d){var w=h+g;_.push(new m.lN(w+1,c))}if(g<f){for(var E=a,S=function(e){var t=M+e;z[e]=E.getLineContent(t),R.takeWhile((function(e){return e.lineNumber<t})),x[e]=R.takeWhile((function(e){return e.lineNumber===t}))},R=new T.H9(D),A=h+g,O=f-g,M=r-p-O+A+1,x=[],z=[],P=0;P<O;P++)S(P);_.push(new m.Tx(A+1,h+f,z,x))}p+=v},u=0,h=o.length;u<h;u++){var c=o[u],d=U((0,y.QZ)(c.text),3),f=d[0],g=d[1],v=d[2];this._tokens.acceptEdit(c.range,f,g),this._tokens2.acceptEdit(c.range,f,g,v,c.text.length>0?c.text.charCodeAt(0):0),this._decorationsTree.acceptReplace(c.rangeOffset,c.rangeLength,c.text.length,c.forceMoveMarkers)}var _=[];this._increaseVersionId();for(var p=n,C=0,b=o.length;C<b;C++)s(C);this._emitContentChangedEvent(new m.dQ(_,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:o,eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return null===i.reverseEdits?void 0:i.reverseEdits}},{key:"undo",value:function(){return this._undoRedoService.undo(this.uri)}},{key:"canUndo",value:function(){return this._undoRedoService.canUndo(this.uri)}},{key:"redo",value:function(){return this._undoRedoService.redo(this.uri)}},{key:"canRedo",value:function(){return this._undoRedoService.canRedo(this.uri)}},{key:"handleBeforeFireDecorationsChangedEvent",value:function(e){var t=this;if(null!==e&&0!==e.size){var n=H(e).map((function(e){return new m.rU(e,t.getLineContent(e),t._getInjectedTextInLine(e))}));this._onDidChangeContentOrInjectedText.fire(new m.D8(n))}}},{key:"changeDecorations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_changeDecorations",value:function(e,t){var n=this,r={addDecoration:function(t,i){return n._deltaDecorationsImpl(e,[],[{range:t,options:i}])[0]},changeDecoration:function(e,t){n._changeDecorationImpl(e,t)},changeDecorationOptions:function(e,t){n._changeDecorationOptionsImpl(e,fe(t))},removeDecoration:function(t){n._deltaDecorationsImpl(e,[t],[])},deltaDecorations:function(t,i){return 0===t.length&&0===i.length?[]:n._deltaDecorationsImpl(e,t,i)}},o=null;try{o=t(r)}catch(a){(0,i.dL)(a)}return r.addDecoration=ee,r.changeDecoration=ee,r.changeDecorationOptions=ee,r.removeDecoration=ee,r.deltaDecorations=ee,o}},{key:"deltaDecorations",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._assertNotDisposed(),e||(e=[]),0===e.length&&0===t.length)return[];try{return this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_getTrackedRange",value:function(e){return this.getDecorationRange(e)}},{key:"_setTrackedRange",value:function(e,t,n){var i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:de[n]}])[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;var r=this._validateRangeRelaxedNoAllocations(t),o=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),a=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),o,a,r),i.setOptions(de[n]),this._decorationsTree.insert(i),i.id}},{key:"removeAllDecorationsWithOwnerId",value:function(e){if(!this._isDisposed)for(var t=this._decorationsTree.collectNodesFromOwner(e),n=0,i=t.length;n<i;n++){var r=t[n];this._decorationsTree.delete(r),delete this._decorations[r.id]}}},{key:"getDecorationOptions",value:function(e){var t=this._decorations[e];return t?t.options:null}},{key:"getDecorationRange",value:function(e){var t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}},{key:"getLineDecorations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}},{key:"getLinesDecorations",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.getLineCount(),a=Math.min(o,Math.max(1,e)),s=Math.min(o,Math.max(1,t)),u=this.getLineMaxColumn(s),l=new h.e(a,1,s,u),c=this._getDecorationsInRange(l,i,r);return(n=c).push.apply(n,H(this._decorationProvider.getDecorationsInRange(l,i,r))),c}},{key:"getDecorationsInRange",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.validateRange(e),o=this._getDecorationsInRange(r,n,i);return(t=o).push.apply(t,H(this._decorationProvider.getDecorationsInRange(r,n,i))),o}},{key:"getOverviewRulerDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._decorationsTree.getAll(this,e,t,!0)}},{key:"getInjectedTextDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._decorationsTree.getAllInjectedText(this,e)}},{key:"_getInjectedTextInLine",value:function(e){var t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return m.gk.fromDecorations(i).filter((function(t){return t.lineNumber===e}))}},{key:"getAllDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._decorationsTree.getAll(this,e,t,!1);return n=n.concat(this._decorationProvider.getAllDecorations(e,t))}},{key:"_getDecorationsInRange",value:function(e,t,n){var i=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),r=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,i,r,t,n)}},{key:"getRangeAt",value:function(e,t){return this._buffer.getRangeAt(e,t-e)}},{key:"_changeDecorationImpl",value:function(e,t){var n=this._decorations[e];if(n){if(n.options.after){var i=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber)}if(n.options.before){var r=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.startLineNumber)}var o=this._validateRangeRelaxedNoAllocations(t),a=this._buffer.getOffsetAt(o.startLineNumber,o.startColumn),s=this._buffer.getOffsetAt(o.endLineNumber,o.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),a,s,o),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.startLineNumber)}}},{key:"_changeDecorationOptionsImpl",value:function(e,t){var n=this._decorations[e];if(n){var i=!(!n.options.overviewRuler||!n.options.overviewRuler.color),r=!(!t.overviewRuler||!t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){var o=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.endLineNumber)}if(n.options.before||t.before){var a=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.startLineNumber)}i!==r?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}}},{key:"_deltaDecorationsImpl",value:function(e,t,n){for(var i=this.getVersionId(),r=t.length,o=0,a=n.length,s=0,u=new Array(a);o<r||s<a;){var l=null;if(o<r){do{l=this._decorations[t[o++]]}while(!l&&o<r);if(l){if(l.options.after){var h=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(h.endLineNumber)}if(l.options.before){var c=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(c.startLineNumber)}this._decorationsTree.delete(l),this._onDidChangeDecorations.checkAffectedAndFire(l.options)}}if(s<a){if(!l){var d=++this._lastDecorationId,f="".concat(this._instanceId,";").concat(d);l=new v.fL(f,0,0),this._decorations[f]=l}var g=n[s],_=this._validateRangeRelaxedNoAllocations(g.range),m=fe(g.options),p=this._buffer.getOffsetAt(_.startLineNumber,_.startColumn),C=this._buffer.getOffsetAt(_.endLineNumber,_.endColumn);l.ownerId=e,l.reset(i,p,C,_),l.setOptions(m),l.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(_.endLineNumber),l.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(_.startLineNumber),this._onDidChangeDecorations.checkAffectedAndFire(m),this._decorationsTree.insert(l),u[s]=l.id,s++}else l&&delete this._decorations[l.id]}return u}},{key:"setTokens",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){for(var n=[],i=0,r=e.length;i<r;i++){for(var o=e[i],a=0,s=0,u=!1,l=0,h=o.tokens.length;l<h;l++){var c=o.startLineNumber+l;if(u)this._tokens.setTokens(this._languageId,c-1,this._buffer.getLineLength(c),o.tokens[l],!1),s=c;else{var d=this._tokens.setTokens(this._languageId,c-1,this._buffer.getLineLength(c),o.tokens[l],!0);d&&(u=!0,a=c,s=c)}}u&&n.push({fromLineNumber:a,toLineNumber:s})}n.length>0&&this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!1,ranges:n})}this.handleTokenizationProgress(t)}},{key:"setSemanticTokens",value:function(e,t){this._tokens2.set(e,t),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:null!==e,ranges:[{fromLineNumber:1,toLineNumber:this.getLineCount()}]})}},{key:"hasCompleteSemanticTokens",value:function(){return this._tokens2.isComplete()}},{key:"hasSomeSemanticTokens",value:function(){return!this._tokens2.isEmpty()}},{key:"setPartialSemanticTokens",value:function(e,t){if(!this.hasCompleteSemanticTokens()){var n=this._tokens2.setPartial(e,t);this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}}},{key:"tokenizeViewport",value:function(e,t){e=Math.max(1,e),t=Math.min(this._buffer.getLineCount(),t),this._tokenization.tokenizeViewport(e,t)}},{key:"clearTokens",value:function(){this._tokens.flush(),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!0,semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._buffer.getLineCount()}]})}},{key:"_emitModelTokensChangedEvent",value:function(e){this._isDisposing||this._onDidChangeTokens.fire(e)}},{key:"resetTokenization",value:function(){this._tokenization.reset()}},{key:"forceTokenization",value:function(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");this._tokenization.forceTokenization(e)}},{key:"isCheapToTokenize",value:function(e){return this._tokenization.isCheapToTokenize(e)}},{key:"tokenizeIfCheap",value:function(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}},{key:"getLineTokens",value:function(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._getLineTokens(e)}},{key:"_getLineTokens",value:function(e){var t=this.getLineContent(e),n=this._tokens.getTokens(this._languageId,e-1,t);return this._tokens2.addSemanticTokens(e,n)}},{key:"getLanguageId",value:function(){return this._languageId}},{key:"setMode",value:function(e){if(this._languageId!==e){var t={oldLanguage:this._languageId,newLanguage:e};this._languageId=e,this._onDidChangeLanguage.fire(t),this._onDidChangeLanguageConfiguration.fire({})}}},{key:"getLanguageIdAtPosition",value:function(e,t){var n=this.validatePosition(new l.L(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}},{key:"getTokenTypeIfInsertingCharacter",value:function(e,t,n){var i=this.validatePosition(new l.L(e,t));return this._tokenization.getTokenTypeIfInsertingCharacter(i,n)}},{key:"getLanguageConfiguration",value:function(e){return this._languageConfigurationService.getLanguageConfiguration(e)}},{key:"getWordAtPosition",value:function(e){this._assertNotDisposed();var t=this.validatePosition(e),i=this.getLineContent(t.lineNumber),r=this._getLineTokens(t.lineNumber),o=r.findTokenIndexAtOffset(t.column-1),a=U(n._findLanguageBoundaries(r,o),2),s=a[0],u=a[1],l=(0,b.t2)(t.column,this.getLanguageConfiguration(r.getLanguageId(o)).getWordDefinition(),i.substring(s,u),s);if(l&&l.startColumn<=e.column&&e.column<=l.endColumn)return l;if(o>0&&s===t.column-1){var h=U(n._findLanguageBoundaries(r,o-1),2),c=h[0],d=h[1],f=(0,b.t2)(t.column,this.getLanguageConfiguration(r.getLanguageId(o-1)).getWordDefinition(),i.substring(c,d),c);if(f&&f.startColumn<=e.column&&e.column<=f.endColumn)return f}return null}},{key:"getWordUntilPosition",value:function(e){var t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}},{key:"_computeIndentLevel",value:function(e){return n.computeIndentLevel(this._buffer.getLineContent(e+1),this._options.tabSize)}},{key:"getActiveIndentGuide",value:function(e,t,n){var i=this;this._assertNotDisposed();var r=this.getLineCount();if(e<1||e>r)throw new Error("Illegal value for lineNumber");for(var o=this.getLanguageConfiguration(this._languageId).foldingRules,a=Boolean(o&&o.offSide),s=-2,u=-1,l=-2,h=-1,c=function(e){if(-1!==s&&(-2===s||s>e-1)){s=-1,u=-1;for(var t=e-2;t>=0;t--){var n=i._computeIndentLevel(t);if(n>=0){s=t,u=n;break}}}if(-2===l){l=-1,h=-1;for(var o=e;o<r;o++){var a=i._computeIndentLevel(o);if(a>=0){l=o,h=a;break}}}},d=-2,f=-1,g=-2,v=-1,_=function(e){if(-2===d){d=-1,f=-1;for(var t=e-2;t>=0;t--){var n=i._computeIndentLevel(t);if(n>=0){d=t,f=n;break}}}if(-1!==g&&(-2===g||g<e-1)){g=-1,v=-1;for(var o=e;o<r;o++){var a=i._computeIndentLevel(o);if(a>=0){g=o,v=a;break}}}},m=0,p=!0,C=0,b=!0,k=0,L=0,y=0;p||b;y++){var D=e-y,N=e+y;y>1&&(D<1||D<t)&&(p=!1),y>1&&(N>r||N>n)&&(b=!1),y>5e4&&(p=!1,b=!1);var I=-1;if(p){var T=this._computeIndentLevel(D-1);T>=0?(l=D-1,h=T,I=Math.ceil(T/this._options.indentSize)):(c(D),I=this._getIndentLevelForWhitespaceLine(a,u,h))}var w=-1;if(b){var E=this._computeIndentLevel(N-1);E>=0?(d=N-1,f=E,w=Math.ceil(E/this._options.indentSize)):(_(N),w=this._getIndentLevelForWhitespaceLine(a,f,v))}if(0!==y){if(1===y){if(N<=r&&w>=0&&L+1===w){p=!1,m=N,C=N,k=w;continue}if(D>=1&&I>=0&&I-1===L){b=!1,m=D,C=D,k=I;continue}if(m=e,C=e,0===(k=L))return{startLineNumber:m,endLineNumber:C,indent:k}}p&&(I>=k?m=D:p=!1),b&&(w>=k?C=N:b=!1)}else L=I}return{startLineNumber:m,endLineNumber:C,indent:k}}},{key:"getLinesBracketGuides",value:function(e,t,n,i){var r,o,s,u,l,c=this,f=function(e){var t=new Array;b.length>0&&(t=t.concat(b),b.length=0),g.push(t);var n=!0,r=!1,h=void 0;try{for(var f,v=(p.takeWhile((function(t){return t.openingBracketRange.startLineNumber<=e}))||[])[Symbol.iterator]();!(n=(f=v.next()).done);n=!0){var m=f.value;if(m.range.startLineNumber!==m.range.endLineNumber){var L=Math.min(c.getVisibleColumnFromPosition(m.openingBracketRange.getStartPosition()),c.getVisibleColumnFromPosition(null!==(s=null===(o=m.closingBracketRange)||void 0===o?void 0:o.getStartPosition())&&void 0!==s?s:m.range.getEndPosition()),m.minVisibleColumnIndentation+1),y=!1;if(m.closingBracketRange)a.LC(c.getLineContent(m.closingBracketRange.startLineNumber))<m.closingBracketRange.startColumn-1&&(y=!0);var D=m.openingBracketRange.getStartPosition(),N=null!==(l=null===(u=m.closingBracketRange)||void 0===u?void 0:u.getStartPosition())&&void 0!==l?l:m.range.getEndPosition();void 0===m.closingBracketRange?C[m.nestingLevel]=null:C[m.nestingLevel]={nestingLevel:m.nestingLevel,guideVisibleColumn:L,start:D,visibleStartColumn:c.getVisibleColumnFromPosition(D),end:N,visibleEndColumn:c.getVisibleColumnFromPosition(N),bracketPair:m,renderHorizontalEndLineAtTheBottom:y}}}}catch(V){r=!0,h=V}finally{try{n||null==v.return||v.return()}finally{if(r)throw h}}var I=!0,T=!1,w=void 0;try{for(var E,S=C[Symbol.iterator]();!(I=(E=S.next()).done);I=!0){var R=E.value;if(R){var A=_&&R.bracketPair.range.equalsRange(_),O=k.getInlineClassNameOfLevel(R.nestingLevel)+(i.highlightActive&&A?" "+k.activeClassName:"");(A&&i.horizontalGuides!==d.s6.Disabled||i.includeInactive&&i.horizontalGuides===d.s6.Enabled)&&(R.start.lineNumber===e&&R.guideVisibleColumn<R.visibleStartColumn&&t.push(new d.UO(R.guideVisibleColumn,O,new d.vW(!1,R.start.column))),R.end.lineNumber===e+1&&R.guideVisibleColumn<R.visibleEndColumn&&b.push(new d.UO(R.guideVisibleColumn,O,new d.vW(!R.renderHorizontalEndLineAtTheBottom,R.end.column))))}}}catch(V){T=!0,w=V}finally{try{I||null==S.return||S.return()}finally{if(T)throw w}}for(var M=Number.MAX_SAFE_INTEGER,x=C.length-1;x>=0;x--){var z=C[x];if(z){var P=i.highlightActive&&_&&z.bracketPair.range.equalsRange(_),F=k.getInlineClassNameOfLevel(z.nestingLevel)+(P?" "+k.activeClassName:"");(P||i.includeInactive)&&z.renderHorizontalEndLineAtTheBottom&&z.end.lineNumber===e+1&&b.push(new d.UO(z.guideVisibleColumn,F,null)),z.end.lineNumber<=e||z.start.lineNumber>=e||z.guideVisibleColumn>=M&&!P||(M=z.guideVisibleColumn,(P||i.includeInactive)&&t.push(new d.UO(z.guideVisibleColumn,F,null)))}}t.sort((function(e,t){return e.visibleColumn-t.visibleColumn}))},g=[],v=this._bracketPairColorizer.getBracketPairsInRangeWithMinIndentation(new h.e(e,1,t,this.getLineMaxColumn(t))),_=void 0;if(n&&v.length>0){var m=e<=n.lineNumber&&n.lineNumber<=t?v.filter((function(e){return h.e.strictContainsPosition(e.range,n)})):this._bracketPairColorizer.getBracketPairsInRange(h.e.fromPositions(n));_=null===(r=(0,T.dF)(m,(function(e){return e.range.startLineNumber!==e.range.endLineNumber})))||void 0===r?void 0:r.range}for(var p=new T.H9(v),C=new Array,b=new Array,k=new ne,L=e;L<=t;L++)f(L);return g}},{key:"getVisibleColumnFromPosition",value:function(e){return S.i.visibleColumnFromColumn(this.getLineContent(e.lineNumber),e.column,this._options.tabSize)+1}},{key:"getLinesIndentGuides",value:function(e,t){this._assertNotDisposed();var n=this.getLineCount();if(e<1||e>n)throw new Error("Illegal value for startLineNumber");if(t<1||t>n)throw new Error("Illegal value for endLineNumber");for(var i=this.getLanguageConfiguration(this._languageId).foldingRules,r=Boolean(i&&i.offSide),o=new Array(t-e+1),a=-2,s=-1,u=-2,l=-1,h=e;h<=t;h++){var c=h-e,d=this._computeIndentLevel(h-1);if(d>=0)a=h-1,s=d,o[c]=Math.ceil(d/this._options.indentSize);else{if(-2===a){a=-1,s=-1;for(var f=h-2;f>=0;f--){var g=this._computeIndentLevel(f);if(g>=0){a=f,s=g;break}}}if(-1!==u&&(-2===u||u<h-1)){u=-1,l=-1;for(var v=h;v<n;v++){var _=this._computeIndentLevel(v);if(_>=0){u=v,l=_;break}}}o[c]=this._getIndentLevelForWhitespaceLine(r,s,l)}}return o}},{key:"_getIndentLevelForWhitespaceLine",value:function(e,t,n){return-1===t||-1===n?0:t<n?1+Math.floor(t/this._options.indentSize):t===n||e?Math.ceil(n/this._options.indentSize):1+Math.floor(n/this._options.indentSize)}},{key:"normalizePosition",value:function(e,t){return e}},{key:"getLineIndentColumn",value:function(e){return function(e){var t=0,n=!0,i=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(" "!==s&&"\t"!==s)break;t++}}catch(u){i=!0,r=u}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return t}(this.getLineContent(e))+1}}],[{key:"resolveOptions",value:function(e,t){if(t.detectIndentation){var n=(0,g.L)(e,t.tabSize,t.insertSpaces);return new d.dJ({tabSize:n.tabSize,indentSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new d.dJ({tabSize:t.tabSize,indentSize:t.indentSize,insertSpaces:t.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}},{key:"_normalizeIndentationFromWhitespace",value:function(e,t,n){for(var i=0,r=0;r<e.length;r++)"\t"===e.charAt(r)?i+=t:i++;var o="";if(!n){var a=Math.floor(i/t);i%=t;for(var s=0;s<a;s++)o+="\t"}for(var u=0;u<i;u++)o+=" ";return o}},{key:"normalizeIndentation",value:function(e,t,i){var r=a.LC(e);return-1===r&&(r=e.length),n._normalizeIndentationFromWhitespace(e.substring(0,r),t,i)+e.substring(r)}},{key:"_findLanguageBoundaries",value:function(e,t){for(var n=e.getLanguageId(t),i=0,r=t;r>=0&&e.getLanguageId(r)===n;r--)i=e.getStartOffset(r);for(var o=e.getLineContent().length,a=t,s=e.getCount();a<s&&e.getLanguageId(a)===n;a++)o=e.getEndOffset(a);return[i,o]}},{key:"computeIndentLevel",value:function(e,t){for(var n=0,i=0,r=e.length;i<r;){var o=e.charCodeAt(i);if(32===o)n++;else{if(9!==o)break;n=n-n%t+t}i++}return i===r?-1:n}}]),n}(o.JT);te.MODEL_SYNC_LIMIT=52428800,te.LARGE_FILE_SIZE_THRESHOLD=20971520,te.LARGE_FILE_LINE_COUNT_THRESHOLD=3e5,te.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:u.DB.tabSize,indentSize:u.DB.indentSize,insertSpaces:u.DB.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:u.DB.trimAutoWhitespace,largeFileOptimizations:u.DB.largeFileOptimizations,bracketPairColorizationOptions:u.DB.bracketPairColorizationOptions},te=J([q(4,N.tJ),q(5,R.h),q(6,k.c_)],te);var ne=function(){function e(){M(this,e),this.activeClassName="indent-active"}return z(e,[{key:"getInlineClassNameOfLevel",value:function(e){return"bracket-indent-guide lvl-".concat(e%30)}}]),e}();function ie(e){return!(!e.options.overviewRuler||!e.options.overviewRuler.color)}function re(e){return!!e.options.after||!!e.options.before}var oe=function(){function e(){M(this,e),this._decorationsTree0=new v.IF,this._decorationsTree1=new v.IF,this._injectedTextDecorationsTree=new v.IF}return z(e,[{key:"ensureAllNodesHaveRanges",value:function(e){this.getAll(e,0,!1,!1)}},{key:"_ensureNodesHaveRanges",value:function(e,t){var n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;null===s.range&&(s.range=e.getRangeAt(s.cachedAbsoluteStart,s.cachedAbsoluteEnd))}}catch(u){i=!0,r=u}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return t}},{key:"getAllInInterval",value:function(e,t,n,i,r){var o=e.getVersionId(),a=this._intervalSearch(t,n,i,r,o);return this._ensureNodesHaveRanges(e,a)}},{key:"_intervalSearch",value:function(e,t,n,i,r){var o=this._decorationsTree0.intervalSearch(e,t,n,i,r),a=this._decorationsTree1.intervalSearch(e,t,n,i,r),s=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,r);return o.concat(a).concat(s)}},{key:"getInjectedTextInInterval",value:function(e,t,n,i){var r=e.getVersionId(),o=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,r);return this._ensureNodesHaveRanges(e,o).filter((function(e){return e.options.showIfCollapsed||!e.range.isEmpty()}))}},{key:"getAllInjectedText",value:function(e,t){var n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n);return this._ensureNodesHaveRanges(e,i).filter((function(e){return e.options.showIfCollapsed||!e.range.isEmpty()}))}},{key:"getAll",value:function(e,t,n,i){var r=e.getVersionId(),o=this._search(t,n,i,r);return this._ensureNodesHaveRanges(e,o)}},{key:"_search",value:function(e,t,n,i){if(n)return this._decorationsTree1.search(e,t,i);var r=this._decorationsTree0.search(e,t,i),o=this._decorationsTree1.search(e,t,i),a=this._injectedTextDecorationsTree.search(e,t,i);return r.concat(o).concat(a)}},{key:"collectNodesFromOwner",value:function(e){var t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}},{key:"collectNodesPostOrder",value:function(){var e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}},{key:"insert",value:function(e){re(e)?this._injectedTextDecorationsTree.insert(e):ie(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}},{key:"delete",value:function(e){re(e)?this._injectedTextDecorationsTree.delete(e):ie(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}},{key:"getNodeRange",value:function(e,t){var n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),null===t.range&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}},{key:"_resolveNode",value:function(e,t){re(e)?this._injectedTextDecorationsTree.resolveNode(e,t):ie(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}},{key:"acceptReplace",value:function(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}]),e}();function ae(e){return e.replace(/[^a-z0-9\-_]/gi," ")}var se=function e(t){M(this,e),this.color=t.color||"",this.darkColor=t.darkColor||""},ue=function(e){V(n,e);var t=Z(n);function n(e){var i;return M(this,n),(i=t.call(this,e))._resolvedColor=null,i.position="number"===typeof e.position?e.position:d.sh.Center,i}return z(n,[{key:"getColor",value:function(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}},{key:"invalidateCachedColor",value:function(){this._resolvedColor=null}},{key:"_resolveColor",value:function(e,t){if("string"===typeof e)return e;var n=e?t.getColor(e.id):null;return n?n.toString():""}}]),n}(se),le=function(e){V(n,e);var t=Z(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).position=e.position,i}return z(n,[{key:"getColor",value:function(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}},{key:"invalidateCachedColor",value:function(){this._resolvedColor=void 0}},{key:"_resolveColor",value:function(e,t){return"string"===typeof e?D.Il.fromHex(e):t.getColor(e.id)}}]),n}(se),he=function(){function e(t){M(this,e),this.content=t.content||"",this.inlineClassName=t.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=t.inlineClassNameAffectsLetterSpacing||!1}return z(e,null,[{key:"from",value:function(t){return B(t,e)?t:new e(t)}}]),e}(),ce=function(){function e(t){var n;M(this,e),this.description=t.description,this.stickiness=t.stickiness||0,this.zIndex=t.zIndex||0,this.className=t.className?ae(t.className):null,this.hoverMessage=t.hoverMessage||null,this.glyphMarginHoverMessage=t.glyphMarginHoverMessage||null,this.isWholeLine=t.isWholeLine||!1,this.showIfCollapsed=t.showIfCollapsed||!1,this.collapseOnReplaceEdit=t.collapseOnReplaceEdit||!1,this.overviewRuler=t.overviewRuler?new ue(t.overviewRuler):null,this.minimap=t.minimap?new le(t.minimap):null,this.glyphMarginClassName=t.glyphMarginClassName?ae(t.glyphMarginClassName):null,this.linesDecorationsClassName=t.linesDecorationsClassName?ae(t.linesDecorationsClassName):null,this.firstLineDecorationClassName=t.firstLineDecorationClassName?ae(t.firstLineDecorationClassName):null,this.marginClassName=t.marginClassName?ae(t.marginClassName):null,this.inlineClassName=t.inlineClassName?ae(t.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=t.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=t.beforeContentClassName?ae(t.beforeContentClassName):null,this.afterContentClassName=t.afterContentClassName?ae(t.afterContentClassName):null,this.after=t.after?he.from(t.after):null,this.before=t.before?he.from(t.before):null,this.hideInCommentTokens=null!==(n=t.hideInCommentTokens)&&void 0!==n&&n}return z(e,null,[{key:"register",value:function(t){return new e(t)}},{key:"createDynamic",value:function(t){return new e(t)}}]),e}();ce.EMPTY=ce.register({description:"empty"});var de=[ce.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),ce.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),ce.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),ce.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function fe(e){return B(e,ce)?e:ce.createDynamic(e)}var ge=function(e){V(n,e);var t=Z(n);function n(e){var i;return M(this,n),(i=t.call(this)).handleBeforeFire=e,i._actual=i._register(new r.Q5),i.event=i._actual.event,i._affectedInjectedTextLines=null,i._deferredCnt=0,i._shouldFire=!1,i._affectsMinimap=!1,i._affectsOverviewRuler=!1,i}return z(n,[{key:"beginDeferredEmit",value:function(){this._deferredCnt++}},{key:"endDeferredEmit",value:function(){var e;if(this._deferredCnt--,0===this._deferredCnt){if(this._shouldFire){this.handleBeforeFire(this._affectedInjectedTextLines);var t={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler};this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._actual.fire(t)}null===(e=this._affectedInjectedTextLines)||void 0===e||e.clear(),this._affectedInjectedTextLines=null}}},{key:"recordLineAffectedByInjectedText",value:function(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}},{key:"checkAffectedAndFire",value:function(e){this._affectsMinimap||(this._affectsMinimap=!(!e.minimap||!e.minimap.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!(!e.overviewRuler||!e.overviewRuler.color)),this._shouldFire=!0}},{key:"fire",value:function(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._shouldFire=!0}}]),n}(o.JT),ve=function(e){V(n,e);var t=Z(n);function n(){var e;return M(this,n),(e=t.call(this))._fastEmitter=e._register(new r.Q5),e.fastEvent=e._fastEmitter.event,e._slowEmitter=e._register(new r.Q5),e.slowEvent=e._slowEmitter.event,e._deferredCnt=0,e._deferredEvent=null,e}return z(n,[{key:"beginDeferredEmit",value:function(){this._deferredCnt++}},{key:"endDeferredEmit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._deferredCnt--,0===this._deferredCnt&&null!==this._deferredEvent){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;var t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}},{key:"fire",value:function(e){this._deferredCnt>0?this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e:(this._fastEmitter.fire(e),this._slowEmitter.fire(e))}}]),n}(o.JT)}}]);